#ifndef PINE_DEFS_H
#define PINE_DEFS_H
#include <stdint.h>
#include <stddef.h>
#include <stdbool.h>
#include <string.h>
#if defined(__linux__) || defined(__APPLE__) || defined(__FreeBSD__) || defined(__OpenBSD__) || defined(__NetBSD__) || defined(__sun) || defined(__CYGWIN__)
#include <sys/types.h>
#elif defined(_WIN32) || defined(__MINGW32__)
#include <BaseTsd.h>
typedef SSIZE_T ssize_t;
#endif
typedef int8_t i8;
typedef int16_t i16;
typedef int32_t i32;
typedef int64_t i64;
typedef ssize_t isize;
typedef uint8_t u8;
typedef uint16_t u16;
typedef uint32_t u32;
typedef uint64_t u64;
typedef size_t usize;
typedef float f32;
typedef double f64;
typedef struct PineString {
    const char *ptr;
    usize len;
} PineString;

_Noreturn void exit(int code);
int printf(const char *fmt, ...);

#define pinepanic(file, line, fmt, ...) (printf("panic %s:%s: ", file, line), printf(fmt, __VA_ARGS__), printf("\n"), exit(1))
#define pinearrat(file, line, arr, index, N) (*(((index) >= (N)) ? (pinepanic((file), (line), "index %zu is out of bounds: 0..<%zu", (size_t)(index), (size_t)(N)), (arr)) : &(arr)[(index)]))
#define pinesliceat(file, line, arr, index) (*(((index) >= (arr).len) ? (pinepanic((file), (line), "index %zu is out of bounds: 0..<%zu", (size_t)(index), (arr).len), (arr).ptr) : &((arr).ptr)[(index)]))

#define PineSlice1dDef(T, Tname)\
typedef struct PineSlice1d_##Tname {\
    T *ptr;\
    usize len;\
} PineSlice1d_##Tname;
#define pineslice1d(Tname, pointer, length) (PineSlice1d_##Tname){.ptr = (pointer), .len = (length)}
#define pineslice1d_range(Tname, pointer, start, end) (PineSlice1d_##Tname){.ptr = &(pointer)[(start)], .len = (end)}

#define PineSlice2dDef(T, Tname)\
typedef struct PineSlice2d_##Tname {\
    PineSlice1d_##Tname *ptr;\
    usize len;\
} PineSlice2d_##Tname;
#define pineslice2d(Tname, pointer, length) (PineSlice2d_##Tname){.ptr = (pointer), .len = (length)}
#define pineslice2d_range(Tname, pointer, start, end) (PineSlice2d_##Tname){.ptr = &(pointer)[(start)], .len = (end)}

#define PineOptionDef(T, Tname)\
typedef struct PineOption_##Tname {\
    T some;\
    bool ok;\
} PineOption_##Tname;
#define pineoption(Tname, val) (PineOption_##Tname){.some = (val), .ok = true}
#define pineoptionnull(Tname) (PineOption_##Tname){.ok = false}

